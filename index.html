<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Home</title>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css" rel="stylesheet" />
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js"></script>
    <link href="custom.css" rel="stylesheet" /></link>
</head>

<body>
    <div id="map">
        <div class="search-container">
            <div class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <rect opacity="0.5" x="17.0365" y="15.1223" width="8.15546" height="2" rx="1"
                        transform="rotate(45 17.0365 15.1223)" fill="black" />
                    <path
                        d="M11 19C6.55556 19 3 15.4444 3 11C3 6.55556 6.55556 3 11 3C15.4444 3 19 6.55556 19 11C19 15.4444 15.4444 19 11 19ZM11 5C7.53333 5 5 7.53333 5 11C5 14.4667 7.53333 17 11 17C14.4667 17 17 14.4667 17 11C17 7.53333 14.4667 5 11 5Z"
                        fill="black" />
                </svg>
            </div>
            <input type="text" placeholder="Search...">
            <select>
                <option value="state">State</option>
                <option value="metro">Metro</option>
                <option value="county">County</option>
                <option value="zip-code">Zip Code</option>
            </select>
        </div>
        <div class="menu-container">
            <div class="my-menu-item">
                Investor Trends
                <div class="my-dropdown-menu">
                    <label><input type="checkbox" /><span></span> Rental Rate</label>
                    <label><input type="checkbox" /><span></span> Rent for Houses</label>
                    <label><input type="checkbox" /><span></span> Cap Rate</label>
                    <label><input type="checkbox" /><span></span> Vacancy Rate</label>
                    <label><input type="checkbox" /><span></span> Rent as % of Income</label>
                    <label><input type="checkbox" /><span></span> Shadow Inventory %</label>
                    <label><input type="checkbox" /><span></span> Rent Growth</label>
                    <label><input type="checkbox" /><span></span> Fair Market Rents (Section 8)</label>
                    <label><input type="checkbox" /><span></span> Historical Bond Market Options for 1 yr through 30
                        yr</label>
                    <label><input type="checkbox" /><span></span> School Rank</label>
                    <label><input type="checkbox" /><span></span> Military %</label>
                </div>
            </div>
            <div class="my-menu-item">
                Demographics
                <div class="my-dropdown-menu">
                    <label><input type="checkbox" /><span></span> Population</label>
                    <label><input type="checkbox" /><span></span> Rent as % of Income</label>
                    <label><input type="checkbox" /><span></span> Population Growth</label>
                    <label><input type="checkbox" /><span></span> Income Growth</label>
                    <label><input type="checkbox" /><span></span> Homeownership Rate</label>
                    <label><input type="checkbox" /><span></span> Mortgaged Home %</label>
                    <label><input type="checkbox" /><span></span> Median Age</label>
                    <label><input type="checkbox" /><span></span> Poverty Rate</label>
                    <label><input type="checkbox" /><span></span> Housing Units</label>
                    <label><input type="checkbox" /><span></span> Housing Unit Growth Rate</label>
                </div>
            </div>
            <div class="my-menu-item">
                Affordability
                <div class="my-dropdown-menu">
                    <label><input type="checkbox" /><span></span> Home Value</label>
                    <label><input type="checkbox" /><span></span> Home Value Growth (YOY)</label>
                    <label><input type="checkbox" /><span></span> Overvalued %</label>
                    <label><input type="checkbox" /><span></span> Value/Income Ratio</label>
                    <label><input type="checkbox" /><span></span> Mortgage Payment</label>
                    <label><input type="checkbox" /><span></span> Salary to Afford a House</label>
                    <label><input type="checkbox" /><span></span> Mtg Payment as % of income</label>
                    <label><input type="checkbox" /><span></span> Property Tax Rate</label>
                    <label><input type="checkbox" /><span></span> Buy v Rent Differential</label>
                </div>
            </div>
            <div class="my-menu-item">
                Market Trends
                <div class="my-dropdown-menu">
                    <label><input type="checkbox" /><span></span> For Sale Inventory</label>
                    <label><input type="checkbox" /><span></span> Sale Inventory growth2</label>
                    <label><input type="checkbox" /><span></span> Inventory Surplus/Deficit</label>
                    <label><input type="checkbox" /><span></span> Price Cut %</label>
                    <label><input type="checkbox" /><span></span> Days on Market</label>
                    <label><input type="checkbox" /><span></span> Inventory as % of Houses</label>
                    <label><input type="checkbox" /><span></span> Median Listing Price</label>
                    <label><input type="checkbox" /><span></span> New Llisting Count</label>
                </div>
            </div>
        </div>
    </div>
    <div id="dashboardModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <div class="dashboard">
                <div class="card">
                    <h3>MEDIAN PRICE</h3>
                    <div class="value">$480k</div>
                    <div class="change">1% MoM ▲</div>
                </div>

                <div class="card">
                    <h3>MEDIAN DOM</h3>
                    <div class="value">49 days</div>
                    <div class="change">3 Days MoM ▲</div>
                </div>

                <div class="card">
                    <h3>SALE TO LIST</h3>
                    <div class="value">98%</div>
                    <div class="change negative">0% MoM ▼</div>
                </div>
                <div class="card">
                    <h3>MEDIAN PRICE</h3>
                    <div class="value">$480k</div>
                    <div class="change">1% MoM ▲</div>
                </div>

                <div class="card">
                    <h3>MEDIAN DOM</h3>
                    <div class="value">49 days</div>
                    <div class="change">3 Days MoM ▲</div>
                </div>

                <div class="card">
                    <h3>SALE TO LIST</h3>
                    <div class="value">98%</div>
                    <div class="change negative">0% MoM ▼</div>
                </div>

            </div>
        </div>
    </div>
</body>
<script>
    function openModal() {
        document.getElementById("dashboardModal").style.display = "flex";
    }

    function closeModal() {
        document.getElementById("dashboardModal").style.display = "none";
    }

    // Close modal if clicking outside the content
    window.onclick = function (event) {
        let modal = document.getElementById("dashboardModal");
        if (event.target === modal) {
            modal.style.display = "none";
        }
    }

    mapboxgl.accessToken = 'pk.eyJ1IjoiZ2ljb2RlcmdhbCIsImEiOiJjazcxODNscXYwM3R3M2V0aGcwMWxvcWV0In0.s246-Q7mSmCOOeqwP-HGtA';

    const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/dark-v11',
        center: [-96, 37.8],
        zoom: 4.5,
        minZoom: 4.5,
        maxZoom: 15,
        attributionControl: false
    });
    const statesBoundariesUrl = 'https://raw.githubusercontent.com/jgoodall/us-maps/master/geojson/state.geo.json';
    const countiesBoundariesUrl = 'https://raw.githubusercontent.com/joelwolfgang/GEOJson-US-Counties/master/usCounties.geojson';
    const zipcodeUrl = 'https://raw.githubusercontent.com/talentdev0314/zip-code/main/zips-by_county.json';


    let currentPopup = null;
    let highlightedCityId = null;



    map.on('load', () => {
        map.addSource('city-borders', {
            type: 'geojson',
            data: countiesBoundariesUrl
        });
        map.addSource('state-borders', {
            type: 'geojson',
            data: statesBoundariesUrl
        });
        map.addLayer({
            id: 'city-borders-layer',
            type: 'fill',
            source: 'city-borders',
            paint: {
                'fill-color': '#00FF47',
                'fill-opacity': 0.3,
                'fill-outline-color': '#000000'
            }
        });
        map.addLayer({
            id: 'state-borders-layer',
            type: 'line',
            source: 'state-borders',
            paint: {
                'line-color': '#000000',
                'line-width': 2
            }
        });

        map.on('mousemove', 'city-borders-layer', async (e) => {
            if (!e.features || e.features.length === 0) {
                return;
            }

            map.getCanvas().style.cursor = 'pointer';
            const cityName = e.features[0].properties.COUNTY_STATE_NAME;
            const geoid = e.features[0].properties.GEOID;
            let homeValue = 'N/A';

            if (currentPopup) {
                currentPopup.remove();
            }
            currentPopup = new mapboxgl.Popup()
                .setLngLat(e.lngLat)
                .setHTML(`
          <strong>${cityName}</strong><br>
          Home Value: ${homeValue}
        `)
                .addTo(map);

            if (highlightedCityId && highlightedCityId !== geoid) {
                map.setPaintProperty('city-borders-layer', 'fill-opacity', 0.3);
            }

            highlightedCityId = geoid;
            map.setPaintProperty('city-borders-layer', 'fill-opacity', [
                'case',
                ['==', ['get', 'GEOID'], highlightedCityId],
                0.6,
                0.3
            ]);
        });
        map.on('mouseleave', 'city-borders-layer', () => {
            map.getCanvas().style.cursor = '';  // Reset cursor
            map.setPaintProperty('city-borders-layer', 'fill-opacity', 0.3);
            if (currentPopup) {
                currentPopup.remove();
                currentPopup = null;
            }
            highlightedCityId = null;
        });
        map.on('click', 'city-borders-layer', async function (e) {
            if (!e.features || e.features.length === 0) {
                return;
            }
            console.log(e.features[0])

            const cityName = e.features[0].properties.COUNTY_STATE_NAME;
            const fipsCode = e.features[0].properties.FIPS_CODE;
            const year = 2023;
            const stateCode = fipsCode.split('-')[0];
            const countyCode = fipsCode.split('-')[1];

            const population = await fetchPopulationDataByYearState(year, stateCode);
            openModal(cityName, fipsCode, population);
            console.log('Population Data:', population);

        });
    });

</script>
<script src="custom.js"></script>

</html>